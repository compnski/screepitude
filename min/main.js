var Agent,Config,PathUtils;PathUtils=require("path_utils"),Config=require("config"),Agent=function(){function a(a){this.creep=a}return a.prototype.setState=function(a){return this.creep.memory.state=a},a.prototype.moveTo=function(a){return null!=a.pos&&(a=a.pos),a.roomName!==this.creep.pos.roomName?this.creep.moveTo(Game.roomNameToPos[a.roomName],{reusePath:20}):this.creep.moveTo(a,{resusePath:20})},a.prototype.loop=function(){var a;return this.fullEnergy()?this.giveEnergyToSpawn(this.nearestEnergyNeed()):(a=this.creep.room.find(FIND_SOURCES),this.harvestFromSource(a[0]))},a.prototype.harvestFromSource=function(a){return this.creep.harvest(a)===ERR_NOT_IN_RANGE?this.creep.moveTo(a):void 0},a.prototype.primarySpawn=function(){return Game.spawns.Spawn1},a.prototype.giveEnergyToSpawn=function(a){return this.creep.transfer(a,RESOURCE_ENERGY)===ERR_NOT_IN_RANGE?this.creep.moveTo(a):null!=a.renewCreep&&Config.RewnewCreeps?a.renewCreep(this.creep):void 0},a.prototype.fullEnergy=function(){return this.creep.carry.energy>=this.creep.carryCapacity},a.prototype.needsEnergy=function(){return!1},a.prototype.hasEnergy=function(){return!1},a.prototype.log=function(a){return console.log("["+this.creep.name+"] "+a)},a}(),module.exports=Agent;var Builder,Config,Deliverator,PathUtils,bind=function(a,b){return function(){return a.apply(b,arguments)}},extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;PathUtils=require("path_utils"),Deliverator=require("deliverator"),Config=require("config"),Builder=function(a){function b(a,c,d){null==c&&(c=null),null==d&&(d=null),this.constructionSite=bind(this.constructionSite,this),null!=d?this.target=d:this.target=a,null==c&&(this.pathUtils||(this.pathUtils=new PathUtils(this.target)),c=this.pathUtils.nearestEnergyProvider),b.__super__.constructor.call(this,a,c,this.constructionSite),a.memory.energyRequester=!0}return extend(b,a),b.prototype.ramparts=function(a){return"rampart"===a.structureType&&a.hits<Math.min(Config.MaxWallHP,a.hitsMax)},b.prototype.walls=function(a){return"constructedWall"===a.structureType&&a.hits<Math.min(a.hitsMax,Config.MaxWallHP||3e6)},b.prototype.constructionSite=function(){var a,b,c,d,e;return this.pathUtils||(this.pathUtils=new PathUtils(this.target)),e=this.pathUtils.sortByDistance(this.creep.room.find(FIND_MY_CONSTRUCTION_SITES)),0===e.length&&"far_builder"===this.creep.memory.role&&(e=[],e=e.concat(null!=(a=Game.flags.Room2)&&null!=(b=a.room)?b.find(FIND_MY_CONSTRUCTION_SITES):void 0),e=e.concat(null!=(c=Game.flags.Room3)&&null!=(d=c.room)?d.find(FIND_MY_CONSTRUCTION_SITES):void 0),e=this.pathUtils.sortByDistance(e)),0===e.length&&(e=this.pathUtils.sortByDistance(this.creep.room.find(FIND_MY_STRUCTURES).filter(this.ramparts))),0===e.length&&(e=this.pathUtils.sortByDistance(this.creep.room.find(FIND_STRUCTURES).filter(this.walls))),0===e.length&&"omgbear"===this.creep.room.controller.owner.username&&(e=[this.creep.room.controller]),e[0]},b}(Deliverator),module.exports=Builder;var Cell,MegaMiner;MegaMiner=require("mega_miner"),Cell=function(){function a(a,b){this.room=a,this.targetCounts=b}return a.prototype.nameForRole=function(a){var b,c;return(b=this.room.memory).totalCreepCounts||(b.totalCreepCounts={}),(c=this.room.memory.totalCreepCounts)[a]||(c[a]=0),this.room.memory.totalCreepCounts[a]++,a+"_"+this.room.memory.totalCreepCounts[a]},a.prototype.spawnEnergyCapacity=function(){var a;return function(){var b,c,d,e;for(d=this.room.find(FIND_MY_STRUCTURES),e=[],b=0,c=d.length;c>b;b++)a=d[b],("extension"===a.structureType||"spawn"===a.structureType)&&e.push(a.energyCapacity);return e}.call(this).sum()},a.prototype.spawnEnergy=function(){var a;return function(){var b,c,d,e;for(d=this.room.find(FIND_MY_STRUCTURES),e=[],b=0,c=d.length;c>b;b++)a=d[b],("extension"===a.structureType||"spawn"===a.structureType)&&e.push(a.energy);return e}.call(this).sum()},a.prototype.partsForRole=function(a){switch(a){case"small_transporter":return this.makeRole({carry:2,move:1});case"source1":case"source2":return this.makeRole({work:1,carry:1,move:1});case"upgrader":return this.makeRole({work:8,carry:2,move:5});case"transporter":return this.makeRole({carry:6,move:3});case"room2_transporter":return this.makeRole({carry:9,move:3});case"guard":return this.makeRole({tough:3,move:2,attack:3});case"hunter_killer":case"hunter_killer_2":return this.makeRole({tough:10,move:3,attack:4});case"healbot":case"healbot_2":return this.makeRole({tough:10,heal:1,move:3});case"builder":case"repair":return this.makeRole({work:6,carry:4,move:5});case"far_builder":return this.makeRole({work:4,carry:6,move:5});case"mega_miner":case"mega_miner2":return MegaMiner.bodyParts(this);case"room2_mega_miner":case"room2_mega_miner2":return MegaMiner.bodyParts(this).concat([MOVE]);case"upgrader_filler":return this.makeRole({carry:6,move:3});default:return a.startsWith("position_miner")?-1===a.indexOf("transport")?MegaMiner.bodyParts(this).concat([MOVE]):this.makeRole({carry:12,move:10}):[WORK,CARRY,MOVE]}},a.prototype.makeRole=function(a){var b,c,d,e,f,g;f=[];for(e in a)for(b=a[e],c=d=0,g=b;g>=0?g>d:d>g;c=g>=0?++d:--d)f.push(e);return f},a.prototype.memoryForRole=function(a){return{role:a}},a.prototype.partsCost=function(a){return a.map(function(a){switch(a){case TOUGH:return 10;case MOVE:case CARRY:return 50;case ATTACK:return 80;case WORK:return 100;case RANGED_ATTACK:return 150;case HEAL:return 250}}).sum()},a.prototype.spawn=function(a,b){var c,d,e,f,g;return d=this.nameForRole(b),e=this.partsForRole(b),c=this.memoryForRole(b),f=this.partsCost(e),f>this.spawnEnergyCapacity()?(console.log("Can't spawn "+b+" due to max capacity -- have "+this.spawnEnergyCapacity()+"/"+f),!1):(g=a.createCreep(e,d,c),g===ERR_NOT_ENOUGH_RESOURCES?(console.log("Can't spawn "+b+" due to resources -- have "+this.spawnEnergy()+"/"+f),this.spawnFailed=!0,!0):0>g?(console.log("Can't spawn "+b+" due to other error: "+err+" -- have "+this.spawnEnergy()+"/"+f),!1):(console.log("Spawning "+b+" named "+d+" from "+a.name+" with "+e+" and "+JSON.stringify(c)+", got "+g),!0))},a.prototype.loop=function(){var a,b,c,d,e,f,g,h,i,j,k;if(j=Game.spawns.Spawn1,!(Game.cpu.bucket<1500||j.spawning)){c={},e=0,f=Game.creeps;for(a in f)b=f[a],b.ticksToLive<150||(c[d=b.memory.role]||(c[d]=0),c[b.memory.role]++,e++);if(5>e&&(Game.notify("EMERGENCY: CreepCount low: "+JSON.stringify(c)),this.targetCounts.small_transporter=1,this.targetCounts.source1=2,this.targetCounts.source2=2),console.log("\n"),console.log(JSON.stringify(c)),!j.spawning){g=this.targetCounts,h=[];for(i in g)if(k=g[i],(c[i]||0)<k){if(this.spawn(j,i))break;h.push(void 0)}else h.push(void 0);return h}}},a}(),module.exports=Cell,module.exports={ThrowExceptions:!0,CreepRenewEnergy:100,NoUpgrades:!1,NoRepairs:!1,NoBuilders:!1,MaxWallHP:4e4};var Agent,Config,Deliverator,shortName,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Agent=require("agent"),Config=require("config"),shortName=function(a){var b;return b=(a.name||a.structureType||a.id||"").split("_"),2===b.length?b[0][0]+"_"+b[1]:b.map(function(a){return a.slice(0,4)})},Deliverator=function(a){function b(a,c,d){var e;this.sourceFn=c,this.targetFn=d,b.__super__.constructor.call(this,a),(e=this.creep.memory).state||(e.state="fill")}return extend(b,a),b.prototype.fill=function(){var a,b,c,d;return d=Game.getObjectById(this.creep.memory.sourceId),null==d&&(d=this.sourceFn(),null!=d&&this.creep.say("-> "+(d.name||d.structureType||d.id)),null!=d&&this.log("fill from "+(d.name||d.structureType||d.id||d.constructor))),null==d?!1:(this.creep.memory.sourceId=d.id,this.creep.pos.isNearTo(d)?(b=function(){switch(!1){case!(d.structureType===STRUCTURE_SPAWN||d.structureType===STRUCTURE_EXTENSION):return function(a){return function(){return d.transferEnergy(a.creep)}}(this);case null==d.transfer:return function(a){return function(){return d.transfer(a.creep,RESOURCE_ENERGY)}}(this);case d.constructor!==Source:return function(a){return function(){return a.creep.harvest(d)}}(this)}}.call(this),c=-1,(a=this.creep.memory.lastErr=b())===ERR_NOT_IN_RANGE&&(c=this.moveTo(d,{resusePath:60}))===ERR_NO_PATH&&this.creep.memory.failCount++,0>a&&a!==ERR_NOT_IN_RANGE&&a!==ERR_NOT_ENOUGH_RESOURCES&&this.creep.memory.failCount++,this.creep.memory.failCount>10&&(delete this.creep.memory.sourceId,this.creep.memory.failCount=0,this.log("fill fail")),!this.creep.memory.sourceId&&this.creep.carry.energy>20&&(this.creep.memory.state="deliver"),!0):void this.moveTo(d))},b.prototype.deliver=function(){var a,b,c,d;return d=Game.getObjectById(this.creep.memory.deliverId),d||(d||(d=this.targetFn()),null!=d&&this.creep.say("<- "+shortName(d)),null!=d&&this.log("deliver to "+(d.name||d.structureType||d.constructor)+" "+this.creep.memory.failCount)),null==d?!1:(this.creep.memory.deliverId=d.id,this.creep.pos.isNearTo(d)?(a=function(){switch(!1){case d.structureType!==STRUCTURE_CONTROLLER:return function(a){return function(){return a.creep.upgradeController(d)}}(this);case d.constructor!==ConstructionSite:return function(a){return function(){return a.creep.build(d)}}(this);case!(d.structureType===STRUCTURE_WALL||d.structureType===STRUCTURE_ROAD||d.structureType===STRUCTURE_RAMPART):return function(a){return function(){return a.creep.repair(d)}}(this);default:return function(a){return function(){return a.creep.transfer(d,RESOURCE_ENERGY)}}(this)}}.call(this),c=-1,(b=this.creep.memory.lastErr=a())===ERR_NOT_IN_RANGE?(c=this.moveTo(d,{resusePath:50}))===ERR_NO_PATH&&this.creep.memory.failCount++:null!=d.renewCreep&&this.creep.ticksToLive<parseInt(Config.CreepRenewEnergy)&&d.renewCreep(this.creep),0!==c?(-8===b&&delete this.creep.memory.deliverId,0>b&&b!==ERR_NOT_IN_RANGE&&(this.log(b),this.creep.memory.failCount++),this.creep.memory.failCount>10&&(this.log("deliver fail"),delete this.creep.memory.deliverId,this.creep.memory.failCount=0),"repair"===this.creep.memory.role&&d.hits>=Math.min(d.hitsMax,Config.MaxWallHP)&&(delete this.creep.memory.deliverId,this.creep.memory.failCount=0),!0):void 0):void this.moveTo(d,{resusePath:60}))},b.prototype.loop=function(){var a;try{return this.loopAction()}catch(b){return a=b,this.log(a.stack)}},b.prototype.loopAction=function(){var a;switch(this.creep.memory.state){case"fill":a=this.fill();break;case"deliver":a=this.deliver();break;case"renew":return void this.setState("deliver")}switch(!1){case!this.fullEnergy():delete this.creep.memory.sourceId,this.setState("deliver"),this.creep.memory.failCount=0;break;case 0!==this.creep.carry.energy:this.setState("fill"),this.creep.memory.failCount=0,delete this.creep.memory.deliverId}return a},b}(Agent),module.exports=Deliverator;var Agent,Guard,PathUtils,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Agent=require("agent"),PathUtils=require("path_utils"),Guard=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.chooseTarget=function(){var a;return a=new PathUtils(this.creep).sortByDistance(this.creep.room.find(FIND_HOSTILE_CREEPS)),a[0]},b.prototype.loop=function(){var a,b,c;return c=this.chooseTarget(),b=Game.flags.Flag1,null!=c&&b.pos.getRangeTo(c)>5&&(c=null),null!=c||this.creep.pos.inRangeTo(b,2)?(a=this.creep.attack(c))===ERR_NOT_IN_RANGE?this.creep.moveTo(c):void 0:void this.creep.moveTo(b)},b}(Agent),module.exports=Guard;var Agent,Healbot,PathUtils,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Agent=require("agent"),PathUtils=require("path_utils"),Healbot=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.chooseTarget=function(){var a;return a=new PathUtils(this.creep).sortByDistance(this.creep.room.find(FIND_MY_CREEPS).filter(function(a){return a.hits<a.hitsMax})),a[0]},b.prototype.loop=function(a){var b;return b=this.chooseTarget(),a||(a=Game.flags.Flag1),null!=b||this.creep.pos.inRangeTo(a,3)?this.target?(this.moveTo(this.target),this.creep.pos.isNearTo(b)?this.creep.heal(b):this.creep.rangedHeal(b)):void 0:void this.creep.moveTo(a)},b}(Agent),module.exports=Healbot;var Agent,HunterKiller,PathUtils,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Agent=require("agent"),PathUtils=require("path_utils"),HunterKiller=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.chooseTarget=function(){var a,b;return b=new PathUtils(this.creep).sortByDistance(this.creep.room.find(FIND_HOSTILE_CREEPS).concat(this.creep.room.find(FIND_HOSTILE_SPAWNS))),0===b.length&&"hunter_killer_2"===this.creep.memory.role&&(b=new PathUtils(this.creep).sortByDistance(this.creep.room.find(FIND_STRUCTURES).filter(function(a){return a.structureType===STRUCTURE_WALL}))),a=b[0],null!=a?(console.log(this.creep.name+" closing in on "+(a.name||a.structureType)+": "+this.creep.pos.getRangeTo(a)+" units"),a):void 0},b.prototype.loop=function(a,b){var c;return a||(a=Game.flags.Flag1),b||(b=this.chooseTarget()),null!=b&&a.pos.getRangeTo(b)>5&&(b=null),null!=b||this.creep.pos.inRangeTo(a,3)?(c=this.creep.attack(b))===ERR_NOT_IN_RANGE?this.creep.moveTo(b):void 0:void this.creep.moveTo(a)},b}(Agent),module.exports=HunterKiller;var main,startCpu;Game.cpu.bucket<1500&&(Game.notify("CPU LOW!",20),main=!1),startCpu=Game.cpu.getUsed(),null==main&&(main=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;F=Game.spawns.Spawn1,E=F.room,G=E.find(FIND_MY_STRUCTURES).filter(function(a){return a.structureType===STRUCTURE_STORAGE})[0],L=Game.flags.Room1.pos,M=Game.flags.Room2.room,N=Game.flags.Room2.pos,O=Game.flags.Room3.room,P=Game.flags.Room3.pos,Q={},Q[L.roomName]=L,Q[N.roomName]=N,Q[P.roomName]=P,Game.roomNameToPos=Q,a=require("agent"),i=require("mine"),e=require("deliverator"),c=require("cell"),b=require("builder"),f=require("guard"),d=require("config"),j=require("path_utils"),g=require("healbot"),h=require("hunter_killer"),k=require("position_miner"),R={small_transporter:1,source1:0,source2:0,transporter:0,position_miner1:1,position_miner1_transport:1,position_miner2:1,position_miner2_transport:1,position_miner3:0,position_miner4:0,position_miner3_transport:0,position_miner4_transport:0,far_builder:0,position_miner5:1,position_miner5_transport:2,position_miner6:1,position_miner6_transport:2,tower_filler:1,transporter:1,repair:d.NoRepairs?void 0:1,builder:d.NoBuilders?void 0:1,upgrader:d.NoUpgrades?void 0:3,upgrader_filler:d.NoUpgrades?void 0:0,guard:3,hunter_killer:2,healbot:2,hunter_killer_2:2,healbot_2:2},Array.prototype.sum=function(){return this.length?this.reduce(function(a,b){return a+b}):0},String.prototype.paddingLeft=function(a){return String(a+this).slice(-a.length)},H=E.find(FIND_MY_STRUCTURES).filter(function(a){return"tower"===a.structureType})[0],z=Game.cpu.getUsed(),console.log("Init took "+(z-startCpu));try{D=new j(H).sortByDistance(E.find(FIND_HOSTILE_CREEPS))[0],null!=D&&H.attack(D)}catch(T){v=T,console.log("Failed to use tower!!!"),Game.notify("Failed to use tower!!!",20)}try{if(function(){var a;a=[];for(m in E.find(FIND_HOSTILE_CREEPS))a.push(1);return a}().length>0){console.log("Under Attack"),R.guard=10,Game.notify("Active BattleMode!! "+E.find(FIND_HOSTILE_CREEPS).length+" hostile creeps in base!!");try{D=new j(H).sortByDistance(E.find(FIND_HOSTILE_CREEPS))[0],null!=D&&H.attack(D)}catch(T){v=T,console.log("Failed to use tower!!!"),Game.notify("Failed to use tower!!!",20)}}H.energy>H.energyCapacity/2&&(D=new j(H).sortByDistance(E.find(FIND_MY_STRUCTURES).filter(function(a){return a.hits<Math.min(a.hitsMax,d.MaxWallHP)}))[0],null!=D&&H.repair(D))}catch(T){if(console.log("Caught exception! "+v),d.ThrowExceptions)throw v}if(y=Game.cpu.getUsed(),console.log("Defense took "+(y-z)),Game.cpu.bucket<1800)return void Game.notify("CPU LOW!",20);try{n=new c(E,R),n.loop(),x=n.spawnFailed}catch(T){if(v=T,d.ThrowExceptions)throw v;console.log("Caught exception! "+v)}if(o=Game.cpu.getUsed(),console.log("Cell took "+(o-y)),!(Game.cpu.bucket<2200&&Game.time%5===0)){S=function(){var a;return a=E.find(FIND_MY_CREEPS).filter(function(a){return"upgrader"===a.memory.role}),a[parseInt(Math.random()*a.length)]},t={},I=Game.creeps;for(A in I)s=I[A],K=s.memory.role,t[K]||(t[K]=[]),t[K].push(s);u=0,q={},J=Game.creeps;for(l in J)if(s=J[l],!(Game.cpu.bucket<500)){null!=Game.flags.ClearTargets&&(delete s.memory.sourceTarget,delete s.memory.deliverTarget),r=Game.cpu.getUsed();try{switch(s.memory.role){case"position_miner1":new k(s,Game.flags.Mine_1_1.pos).loop();break;case"position_miner2":new k(s,Game.flags.Mine_1_2.pos).loop();break;case"position_miner3":new k(s,Game.flags.Mine_2_2.pos).loop();break;case"position_miner4":new k(s,Game.flags.Mine_2_1.pos).loop();break;case"position_miner5":new k(s,Game.flags.Mine_3_1.pos).loop();break;case"position_miner6":new k(s,Game.flags.Mine_3_2.pos).loop();break;case"position_miner1_transport":new e(s,function(){var a;return null!=(a=t.position_miner1)?a[0]:void 0},function(){return G}).loop();break;case"position_miner2_transport":new e(s,function(){var a;return null!=(a=t.position_miner2)?a[0]:void 0},function(){return G}).loop();break;case"position_miner3_transport":new e(s,function(){var a;return null!=(a=t.position_miner3)?a[0]:void 0},function(){return G}).loop();break;case"position_miner4_transport":new e(s,function(){var a;return null!=(a=t.position_miner4)?a[0]:void 0},function(){return G}).loop();break;case"position_miner5_transport":new e(s,function(){var a;return null!=(a=t.position_miner5)?a[0]:void 0},function(){return G}).loop();break;case"position_miner6_transport":new e(s,function(){var a;return null!=(a=t.position_miner6)?a[0]:void 0},function(){return G}).loop();break;case"healbot":new g(s).loop(Game.flags.HuntersMark);break;case"hunter_killer":new h(s).loop(Game.flags.HuntersMark);break;case"healbot_2":new g(s).loop(Game.flags.HuntersMark2);break;case"hunter_killer_2":new h(s).loop(Game.flags.HuntersMark2);break;case"guard":new f(s).loop();break;case"tower_filler":if(!(H.energy<H.energyCapacity))continue;new e(s,function(){return G},function(){return H}).loop();break;case!d.NoUpgrades&&"upgrader_filler":new e(s,function(){return G},S).loop();break;case"upgrader":d.NoUpgrades||new e(s,function(){return G},function(){return s.room.controller}).loop();break;case!d.NoBuilders&&"builder":new b(s,function(){return G}).loop();break;case!d.NoBuilders&&"far_builder":new b(s,null,Game.flags.BuildHere).loop();break;case"source1":new e(s,function(){return E.find(FIND_SOURCES)[0]},function(){return new j(s).nearestEnergyNeed()}).loop();break;case"source2":new e(s,function(){return E.find(FIND_SOURCES)[1]},function(){return new j(s).nearestEnergyNeed()}).loop();break;case"transporter":case"small_transporter":C=function(){var a;return s.pos.roomName!==F.pos.roomName?new j(F).nearestEnergyNeed():(a=new j(s).sortByDistance(s.room.find(FIND_MY_STRUCTURES).filter(function(a){return("extension"===a.structureType||"spawn"===a.structureType)&&a.energy<a.energyCapacity})),a[parseInt(Math.random()*Math.min(a.length,2))])},new e(s,function(){return G},C).loop();break;case"repair":d.NoRepairs||new e(s,function(){return G},function(){return new j(s).sortByDistance(E.find(FIND_STRUCTURES).filter(function(a){return"rampart"!==a.structureType&&a.hits<Math.min(a.hitsMax,d.MaxWallHP)}))[0]}).loop();break;default:console.log("Orphan bot "+s.name)}}catch(T){if(v=T,d.ThrowExceptions)throw v;console.log("Caught exception! "+v)}finally{u+=s.carry.energy,q[B=s.memory.role]||(q[B]=0),q[s.memory.role]+=Game.cpu.getUsed()-r}}for(K in q)p=q[K],p>1&&console.log("Processed "+K.paddingLeft("                                                ")+" 	in "+Math.trunc(1e3*p)+" cpu");return w=Game.cpu.getUsed(),console.log("-----"),console.log("Creeps took "+(w-o)),console.log("Total took "+(w-startCpu)),console.log(" Spawn: "+n.spawnEnergy()+"/"+n.spawnEnergyCapacity()+"	Tower: "+H.energy+"	Creep: "+u+"	Store: "+G.store.energy+"	CPU Bucket: "+Game.cpu.bucket),console.log("FIN")}}),main();var Agent,MegaMiner,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Agent=require("agent"),MegaMiner=function(a){function b(a,c){null==c&&(c=nil),b.__super__.constructor.call(this,a),a.memory.energyProvider=!0,null!=c&&(this.targetSource=a.memory.targetSource=c)}return extend(b,a),b.bodyParts=function(a){var b,c,d;return c=a.spawnEnergyCapacity(),d=Math.min(Math.floor((c-200)/100),9),[MOVE,MOVE,CARRY,CARRY].concat(function(){var a,c,e;for(e=[],b=a=1,c=d;c>=1?c>=a:a>=c;b=c>=1?++a:--a)e.push(WORK);return e}())},b.prototype.loop=function(){var a;if(!this.creep.pos.isNearTo(null!=(a=this.creep.pos.findClosestByRange(FIND_DROPPED_ENERGY))?a.pos:void 0)||0!==this.creep.pickup(this.creep.pos.findClosestByRange(FIND_DROPPED_ENERGY))){switch(this.creep.harvest(this.targetSource)){case ERR_NOT_IN_RANGE:this.creep.moveTo(this.targetSource);break;case ERR_NOT_ENOUGH_RESOURCES:this.creep.pickup(this.creep.pos.findClosestByRange(FIND_DROPPED_ENERGY))}return this.creep.carry.energy>=this.creep.energyCapacity?this.creep.say("I'm Full!"):void 0}},b.prototype.hasEnergy=function(){return this.creep.carry.energy>0},b}(Agent),module.exports=MegaMiner;var Mine;Mine=function(){function a(a){this.source=a}return a.prototype.capacity=function(){var a,b,c,d,e,f,g,h,i;g=this.source.pos.x,h=this.source.pos.y,c=this.source.room.lookForAtArea("terrain",h-1,g-1,h+1,g+1),f=0;for(g in c){i=c[g];for(h in i)for(e=i[h],a=0,b=e.length;b>a;a++)if(d=e[a],"wall"===d){f+=1;break}}return 9-f},a.allInRoom=function(b){var c;return c=b.find(FIND_SOURCES),c.map(function(b){return new a(b)})},a}(),module.exports=Mine;var PathUtils,bind=function(a,b){return function(){return a.apply(b,arguments)}};PathUtils=function(){function a(a){this.creep=a,this.nearestEnergyProvider=bind(this.nearestEnergyProvider,this),this.nearestEnergyNeed=bind(this.nearestEnergyNeed,this),this.distanceComparator=bind(this.distanceComparator,this),this.pos=this.creep,null!=this.creep.pos&&(this.pos=this.creep.pos),this.pos_S=this.pos.roomName+"_"+this.pos.x+"_"+this.pos.y}return a.prototype.sortByDistance=function(a){var b;return b=a.sort(this.distanceComparator)},a.prototype.distance=function(a){return this.pos.getRangeTo(a)},a.prototype.distanceComparator=function(a,b){var c,d,e,f;return null==a.distances&&(a.distances={}),null==(c=a.distances)[e=this.pos_S]&&(c[e]=this.distance(a)),null==b.distances&&(b.distances={}),null==(d=b.distances)[f=this.pos_S]&&(d[f]=this.distance(b)),a.distances[this.pos_S]-b.distances[this.pos_S]},a.prototype.nearestEnergyNeed=function(a){var b;return null==a&&(a=null),a||(a=this.creep.room),b=a.find(FIND_MY_STRUCTURES).filter(function(a){return("extension"===a.structureType||"spawn"===a.structureType)&&a.energy<a.energyCapacity}),this.sortByDistance(b),b[0]},a.prototype.nearestEnergyProvider=function(a){var b;return null==a&&(a=null),a||(a=this.creep.room),b=a.find(FIND_MY_CREEPS).filter(function(a){return a.memory.energyProvider&&a.carry.energy>20}),b=b.concat(a.find(FIND_MY_STRUCTURES).filter(function(a){return("extension"===a.structureType||"spawn"===a.structureType)&&a.energy>0})),this.sortByDistance(b),b[0]},a}(),module.exports=PathUtils;var Agent,PathUtils,PositionMiner,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;PathUtils=require("path_utils"),Agent=require("agent"),PositionMiner=function(a){function b(a,c){this.miningPos=c,b.__super__.constructor.call(this,a),a.memory.energyProvider=!0}return extend(b,a),b.prototype.loop=function(){var a,b;if(!this.fullEnergy()){if(!this.creep.memory.sourceId){if(this.miningPos.roomName!==this.creep.pos.roomName)return this.log("Moving toward "+this.miningPos),void this.creep.moveTo(this.miningPos,{reusePath:50});this.creep.memory.sourceId=new PathUtils(this.miningPos).sortByDistance(this.creep.room.find(FIND_SOURCES))[0].id,this.log("Found source "+this.creep.memory.sourceId)}return this.creep.memory.sourceId&&(b=Game.getObjectById(this.creep.memory.sourceId),(a=this.creep.harvest(b)===ERR_NOT_IN_RANGE)&&this.creep.moveTo(b,{reusePath:10}),-7===a)?(delete this.creep.memory.sourceId,this.log("Deleting sourceId!!")):void 0}},b}(Agent),module.exports=PositionMiner;var Deliverator,PathUtils,Upgrader,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;Deliverator=require("deliverator"),PathUtils=require("path_utils"),Upgrader=function(a){function b(a){b.__super__.constructor.call(this,a,function(){},this.roomController),a.memory.state="deliver",a.memory.energyRequester=!0}return extend(b,a),b.prototype.roomController=function(){return this.creep.room.controller},b.prototype.loop=function(){return b.__super__.loop.call(this),this.creep.memory.state="deliver"},b}(Deliverator),module.exports=Upgrader;
//# sourceMappingURL=main.js.map