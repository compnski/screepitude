{"version":3,"sources":["../v2_out/agent.js","../v2_out/config.js","../v2_out/deliverator.js","../v2_out/main.js","../v2_out/path_utils.js","../v2_out/roles.js","../v2_out/tasks.js"],"names":["Agent","Config","require","creep","this","prototype","setState","state","memory","moveTo","targetPos","opts","pos","maxOps","roomName","reusePath","loop","sources","fullEnergy","giveEnergyToSpawn","nearestEnergyNeed","room","find","FIND_SOURCES","harvestFromSource","source","harvest","ERR_NOT_IN_RANGE","primarySpawn","Game","spawns","Spawn1","spawn","transfer","RESOURCE_ENERGY","renewCreep","RewnewCreeps","carry","energy","carryCapacity","needsEnergy","hasEnergy","log","msg","console","name","module","exports","ThrowExceptions","CreepRenewEnergy","NoUpgrades","NoRepairs","NoBuilders","MaxWallHP","Deliverator","shortName","extend","child","parent","ctor","constructor","key","hasProp","call","__super__","hasOwnProperty","target","parts","structureType","id","split","length","map","s","slice","superClass","target1","base","fill","err","harvestFunc","moveErr","getObjectById","sourceId","say","isNearTo","STRUCTURE_SPAWN","STRUCTURE_EXTENSION","structure","STRUCTURE_STORAGE","_this","transferEnergy","Source","resusePath","ERR_NO_PATH","failCount","ERR_NOT_ENOUGH_RESOURCES","stillValid","energyCapacity","deliver","deliverFunc","deliverId","STRUCTURE_CONTROLLER","upgradeController","ConstructionSite","build","STRUCTURE_WALL","STRUCTURE_ROAD","STRUCTURE_RAMPART","repair","ticksToLive","parseInt","role","hits","Math","min","hitsMax","e","fatigue","loopAction","_error","stack","ret","Role","r","realStart","cpu","getUsed","Array","sum","reduce","a","b","String","paddingLeft","paddingValue","Creep","roleName","p","pop","join","index","arguments","apply","concat","run","message","stacktrace","PathUtils","bind","fn","me","distanceComparator","pos_S","x","y","sortByDistance","targets","t","sort","distance","getRangeTo","base1","name1","distances","Builder","Creeps","GuardFlags","MineFlags","TaskCounts","Tasks","Utils","isAlly","isEnemy","j","len","primaryRoom","primaryStorage","ref","resolveArgs","serializeArg","t1","username","indexOf","my_structures","FIND_MY_STRUCTURES","my_creeps","FIND_MY_CREEPS","hostile_creeps","FIND_HOSTILE_CREEPS","filter","count","creeps","CarryStuff","from","to","primarySpawnOrExtension","c","nearestPrimarySpawnOrExtension","nearestTowerSpawnExtension","energyProviders","push","mineFlagByIndex","guardFlagByIndex","Repair","BuildThings","flags","BuildHere","HealFlag","rally","leash_distance","nearestTarget","pathUtils","HuntersMark2","inRangeTo","friendly_creeps","rangedHeal","ignoreDestructibleStructures","GuardFlag","attacked","body","type","ATTACK","owner","attack","RANGED_ATTACK","rangedAttack","minerByIndex","Mine_1_1","Mine_1_2","Mine_3_1","Mine_3_2","Mine_4_1","FlagMiner","targetFlag","ignoreCreeps","MineTransporter","dumpLocation","arg","function","realStartCpu","_","creepEnergy","endCpu","ref1","roomCpu","startCpu","storage","towerEnergy","runTowers","runSpawner","k","len1","ref2","results","spawnEnergy","spawnEnergyCapacity","store","runCreeps","bucket","creepId","curCreepCount","idx","l","name2","start","spawning","JSON","stringify","spawnCreepFromTask","action","Memory","args","tower","HEAL","heal","FIND_STRUCTURES","runCreep","spawnFrom","task","partsCost","nameForRole","makeRole","notify","createCreep","totalCreepCounts","TOUGH","MOVE","CARRY","WORK","partsMap","i","part","creep1","sourceFn","rallyFlag","constructionSite","energyRequester","ramparts","walls","ref3","ref4","sites","FIND_MY_CONSTRUCTION_SITES","Room2","Room3","move","work","controller","tough","ranged_attack","Flag1"],"mappings":"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","file":"main.js","sourcesContent":["var Agent, Config;\n\nConfig = require('config');\n\nAgent = (function() {\n  function Agent(creep) {\n    this.creep = creep;\n  }\n\n  Agent.prototype.setState = function(state) {\n    return this.creep.memory.state = state;\n  };\n\n  Agent.prototype.moveTo = function(targetPos, opts) {\n    if (opts == null) {\n      opts = {};\n    }\n    if (targetPos.pos != null) {\n      targetPos = targetPos.pos;\n    }\n    opts.maxOps || (opts.maxOps = 1000);\n    if (targetPos.roomName !== this.creep.pos.roomName) {\n      opts.reusePath || (opts.reusePath = 10);\n      return this.creep.moveTo(targetPos, opts);\n    } else {\n      opts.reusePath || (opts.reusePath = 20);\n      return this.creep.moveTo(targetPos, opts);\n    }\n  };\n\n  Agent.prototype.loop = function() {\n    var sources;\n    if (!this.fullEnergy()) {\n      sources = this.creep.room.find(FIND_SOURCES);\n      return this.harvestFromSource(sources[0]);\n    } else {\n      return this.giveEnergyToSpawn(this.nearestEnergyNeed());\n    }\n  };\n\n  Agent.prototype.harvestFromSource = function(source) {\n    if (this.creep.harvest(source) === ERR_NOT_IN_RANGE) {\n      return this.creep.moveTo(source);\n    }\n  };\n\n  Agent.prototype.primarySpawn = function() {\n    return Game.spawns.Spawn1;\n  };\n\n  Agent.prototype.giveEnergyToSpawn = function(spawn) {\n    if (this.creep.transfer(spawn, RESOURCE_ENERGY) === ERR_NOT_IN_RANGE) {\n      return this.creep.moveTo(spawn);\n    } else {\n      if ((spawn.renewCreep != null) && Config.RewnewCreeps) {\n        return spawn.renewCreep(this.creep);\n      }\n    }\n  };\n\n  Agent.prototype.fullEnergy = function() {\n    return this.creep.carry.energy >= this.creep.carryCapacity;\n  };\n\n  Agent.prototype.needsEnergy = function() {\n    return false;\n  };\n\n  Agent.prototype.hasEnergy = function() {\n    return false;\n  };\n\n  Agent.prototype.log = function(msg) {\n    return console.log(\"[\" + this.creep.name + \"] \" + msg);\n  };\n\n  return Agent;\n\n})();\n\nmodule.exports = Agent;\n\n//# sourceMappingURL=agent.js.map\n","module.exports = {\n  ThrowExceptions: true,\n  CreepRenewEnergy: 100,\n  NoUpgrades: false,\n  NoRepairs: false,\n  NoBuilders: false,\n  MaxWallHP: 80000\n};\n\n//# sourceMappingURL=config.js.map\n","var Agent, Config, Deliverator, shortName,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nAgent = require('agent');\n\nConfig = require('config');\n\nshortName = function(target) {\n  var parts;\n  parts = (target.name || target.structureType || target.id || \"\").split(\"_\");\n  if (parts.length === 2) {\n    return parts[0][0] + \"_\" + parts[1];\n  }\n  return parts.map(function(s) {\n    return s.slice(0, 4);\n  });\n};\n\nDeliverator = (function(superClass) {\n  extend(Deliverator, superClass);\n\n  function Deliverator(creep, source, target1) {\n    var base;\n    this.source = source;\n    this.target = target1;\n    Deliverator.__super__.constructor.call(this, creep);\n    (base = this.creep.memory).state || (base.state = 'fill');\n  }\n\n  Deliverator.prototype.fill = function() {\n    var err, harvestFunc, moveErr, target;\n    target = Game.getObjectById(this.creep.memory.sourceId);\n    if (target == null) {\n      target = this.source;\n      if (target != null) {\n        this.creep.say(\"-> \" + (target.name || target.structureType || target.id));\n      }\n      if (target != null) {\n        this.log(\"fill from \" + (target.name || target.structureType || target.id || target.constructor));\n      }\n    }\n    if (target == null) {\n      return false;\n    }\n    this.creep.memory.sourceId = target.id;\n    if (!this.creep.pos.isNearTo(target)) {\n      this.moveTo(target);\n      return;\n    }\n    harvestFunc = (function() {\n      switch (false) {\n        case !(target.structureType === STRUCTURE_SPAWN || target.structureType === STRUCTURE_EXTENSION || target.structure === STRUCTURE_STORAGE):\n          return (function(_this) {\n            return function() {\n              return target.transferEnergy(_this.creep);\n            };\n          })(this);\n        case target.transfer == null:\n          return (function(_this) {\n            return function() {\n              return target.transfer(_this.creep, RESOURCE_ENERGY);\n            };\n          })(this);\n        case target.constructor !== Source:\n          return (function(_this) {\n            return function() {\n              return _this.creep.harvest(target);\n            };\n          })(this);\n      }\n    }).call(this);\n    moveErr = -1;\n    if ((err = harvestFunc()) === ERR_NOT_IN_RANGE) {\n      if ((moveErr = this.moveTo(target, {\n        resusePath: 60\n      })) === ERR_NO_PATH) {\n        this.creep.memory.failCount++;\n      }\n    }\n    if (err < 0 && err !== ERR_NOT_IN_RANGE && err !== ERR_NOT_ENOUGH_RESOURCES) {\n      this.creep.memory.failCount++;\n    }\n    if (this.creep.memory.failCount > 10) {\n      delete this.creep.memory.sourceId;\n      this.creep.memory.failCount = 0;\n      this.log('fill fail');\n    }\n    if (!this.creep.memory.sourceId && this.creep.carry.energy > 20) {\n      this.creep.memory.state = 'deliver';\n    }\n    return true;\n  };\n\n  Deliverator.prototype.stillValid = function(target) {\n    return target && target.energyCapacity > 0 && target.energy !== target.energyCapacity;\n  };\n\n  Deliverator.prototype.deliver = function() {\n    var deliverFunc, err, moveErr, target;\n    target = Game.getObjectById(this.creep.memory.deliverId);\n    if (!target || !this.stillValid(target)) {\n      target || (target = this.target);\n      if (target != null) {\n        this.creep.say(\"<- \" + (shortName(target)));\n      }\n      if (target != null) {\n        this.log(\"deliver to \" + (target.name || target.structureType || target.constructor) + \" \" + this.creep.memory.failCount);\n      }\n    }\n    if (target == null) {\n      return false;\n    }\n    this.creep.memory.deliverId = target.id;\n    if (!this.creep.pos.isNearTo(target)) {\n      this.moveTo(target, {\n        resusePath: 60\n      });\n      return;\n    }\n    deliverFunc = (function() {\n      switch (false) {\n        case target.structureType !== STRUCTURE_CONTROLLER:\n          return (function(_this) {\n            return function() {\n              return _this.creep.upgradeController(target);\n            };\n          })(this);\n        case target.constructor !== ConstructionSite:\n          return (function(_this) {\n            return function() {\n              return _this.creep.build(target);\n            };\n          })(this);\n        case !(target.structureType === STRUCTURE_WALL || target.structureType === STRUCTURE_ROAD || target.structureType === STRUCTURE_RAMPART):\n          return (function(_this) {\n            return function() {\n              return _this.creep.repair(target);\n            };\n          })(this);\n        default:\n          return (function(_this) {\n            return function() {\n              return _this.creep.transfer(target, RESOURCE_ENERGY);\n            };\n          })(this);\n      }\n    }).call(this);\n    moveErr = -1;\n    if ((err = deliverFunc()) === ERR_NOT_IN_RANGE) {\n      if ((moveErr = this.moveTo(target, {\n        resusePath: 50\n      })) === ERR_NO_PATH) {\n        this.creep.memory.failCount++;\n      }\n    } else if (target.renewCreep != null) {\n      if (this.creep.ticksToLive < parseInt(Config.CreepRenewEnergy)) {\n        target.renewCreep(this.creep);\n      }\n    }\n    if (moveErr === 0) {\n      return;\n    }\n    if (err === -8) {\n      delete this.creep.memory.deliverId;\n    }\n    if (err < 0 && err !== ERR_NOT_IN_RANGE) {\n      this.log(err);\n      this.creep.memory.failCount++;\n    }\n    if (this.creep.memory.failCount > 10) {\n      this.log('deliver fail');\n      delete this.creep.memory.deliverId;\n      this.creep.memory.failCount = 0;\n    }\n    if (this.creep.memory.role === 'repair' && target.hits >= Math.min(target.hitsMax, Config.MaxWallHP)) {\n      delete this.creep.memory.deliverId;\n      this.creep.memory.failCount = 0;\n    }\n    return true;\n  };\n\n  Deliverator.prototype.loop = function() {\n    var e;\n    if (this.creep.fatigue > 0) {\n      return;\n    }\n    try {\n      return this.loopAction();\n    } catch (_error) {\n      e = _error;\n      return this.log(e.stack);\n    }\n  };\n\n  Deliverator.prototype.loopAction = function() {\n    var ret;\n    switch (this.creep.memory.state) {\n      case 'fill':\n        ret = this.fill();\n        break;\n      case 'deliver':\n        ret = this.deliver();\n        break;\n      case 'renew':\n        this.setState('deliver');\n        return;\n        if (Game.spawns.Spawn1.renewCreep(this.creep) === ERR_NOT_IN_RANGE) {\n          this.creep.moveTo(Game.spawns.Spawn1);\n        }\n        if (this.creep.ticksToLive > Math.min(Config.CreepRenewEnergy * 2, 1400) || Game.spawns.Spawn1.energy === 0) {\n          this.setState('');\n        }\n    }\n    switch (false) {\n      case this.creep.memory.state !== 'renew':\n        'nothing';\n        break;\n      case !this.fullEnergy():\n        delete this.creep.memory.sourceId;\n        this.setState('deliver');\n        this.creep.memory.failCount = 0;\n        break;\n      case this.creep.carry.energy !== 0:\n        this.setState('fill');\n        this.creep.memory.failCount = 0;\n        delete this.creep.memory.deliverId;\n    }\n    return ret;\n  };\n\n  return Deliverator;\n\n})(Agent);\n\nmodule.exports = Deliverator;\n\n//# sourceMappingURL=deliverator.js.map\n","var Role, e, r, realStart,\n  slice = [].slice;\n\nrealStart = Game.cpu.getUsed();\n\nArray.prototype.sum = function() {\n  if (!this.length) {\n    return 0;\n  }\n  return this.reduce(function(a, b) {\n    return a + b;\n  });\n};\n\nString.prototype.paddingLeft = function(paddingValue) {\n  return String(paddingValue + this).slice(-paddingValue.length);\n};\n\nCreep.prototype.roleName = function() {\n  var p;\n  p = this.name.split(\"_\");\n  p.pop();\n  return p.join(\"_\");\n};\n\nCreep.prototype.index = function() {\n  var parts;\n  parts = this.name.split(\"_\");\n  return parts[parts.length - 2];\n};\n\nCreep.prototype.log = function() {\n  var msg;\n  msg = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n  return console.log.apply(console, [\"[\" + this.name + \"]\"].concat(slice.call(msg)));\n};\n\nRole = require('roles');\n\nr = new Role();\n\ntry {\n  r.run(realStart);\n} catch (_error) {\n  e = _error;\n  console.log(e.message);\n  console.log(e.stacktrace);\n}\n\n//# sourceMappingURL=main.js.map\n","var PathUtils,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nPathUtils = (function() {\n  function PathUtils(pos) {\n    this.pos = pos;\n    this.distanceComparator = bind(this.distanceComparator, this);\n    if (this.pos.pos) {\n      this.pos = this.pos.pos;\n    }\n    this.pos_S = this.pos.roomName + \"_\" + this.pos.x + \"_\" + this.pos.y;\n  }\n\n  PathUtils.prototype.sortByDistance = function(targets) {\n    var t;\n    t = targets.sort(this.distanceComparator);\n    return t;\n  };\n\n  PathUtils.prototype.distance = function(target) {\n    return this.pos.getRangeTo(target);\n  };\n\n  PathUtils.prototype.distanceComparator = function(a, b) {\n    var base, base1, name, name1;\n    if (a.distances == null) {\n      a.distances = {};\n    }\n    if ((base = a.distances)[name = this.pos_S] == null) {\n      base[name] = this.distance(a);\n    }\n    if (b.distances == null) {\n      b.distances = {};\n    }\n    if ((base1 = b.distances)[name1 = this.pos_S] == null) {\n      base1[name1] = this.distance(b);\n    }\n    return a.distances[this.pos_S] - b.distances[this.pos_S];\n  };\n\n  return PathUtils;\n\n})();\n\nmodule.exports = PathUtils;\n\n//# sourceMappingURL=path_utils.js.map\n","var Builder, Config, Creeps, Deliverator, GuardFlags, MineFlags, PathUtils, Role, TaskCounts, Tasks, Utils, creep, isAlly, isEnemy, j, len, name, name1, primaryRoom, primarySpawn, primaryStorage, ref, resolveArgs, serializeArg, t, t1,\n  slice = [].slice,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nPathUtils = require('path_utils');\n\nDeliverator = require('deliverator');\n\nConfig = require('config');\n\nTasks = require('tasks');\n\nisAlly = function(username) {\n  return ['omgbear', 'ganz', 'fezeral', 'scorps'].indexOf() > -1;\n};\n\nisEnemy = function(username) {\n  return !isAlly(username);\n};\n\nt1 = Game.cpu.getUsed();\n\nprimarySpawn = Game.spawns.Spawn1;\n\nprimaryRoom = primarySpawn.room;\n\nprimaryRoom.my_structures = primaryRoom.find(FIND_MY_STRUCTURES);\n\nprimaryRoom.my_creeps = primaryRoom.find(FIND_MY_CREEPS);\n\nprimaryRoom.hostile_creeps = primaryRoom.find(FIND_HOSTILE_CREEPS);\n\nprimaryStorage = primaryRoom.my_structures.filter(function(s) {\n  return s.structureType === STRUCTURE_STORAGE;\n})[0];\n\nTaskCounts = {};\n\nfor (j = 0, len = Tasks.length; j < len; j++) {\n  t = Tasks[j];\n  TaskCounts[name1 = t.role] || (TaskCounts[name1] = 0);\n  TaskCounts[t.role] += t.count;\n}\n\nCreeps = {};\n\nref = Game.creeps;\nfor (name in ref) {\n  creep = ref[name];\n  Creeps[creep.roleName()] = creep.id;\n}\n\nUtils = {};\n\nUtils.CarryStuff = function(creep, from, to) {\n  return new Deliverator(creep, from, to).loop();\n};\n\nUtils.primarySpawnOrExtension = function() {\n  return primaryRoom.my_structures.filter(function(c) {\n    return (c.structureType === 'extension' || c.structureType === 'spawn') && c.energy < c.energyCapacity;\n  });\n};\n\nUtils.nearestPrimarySpawnOrExtension = function(creep) {\n  var targets;\n  targets = new PathUtils(creep).sortByDistance(Utils.primarySpawnOrExtension());\n  return targets[0];\n};\n\nUtils.nearestTowerSpawnExtension = function(creep) {\n  var targets;\n  targets = primaryRoom.my_structures.filter(function(c) {\n    return (c.structureType === 'tower') && c.energy < c.energyCapacity;\n  });\n  if (targets.length === 0) {\n    targets = Utils.primarySpawnOrExtension();\n  }\n  targets = new PathUtils(creep).sortByDistance(targets);\n  return targets[0];\n};\n\nUtils.energyProviders = function(creep) {\n  var s;\n  s = creep.room.find(FIND_MY_CREEPS).filter(function(c) {\n    return c.carryCapacity > 200 && c.carry.energy > 100;\n  });\n  s.push(primaryStorage);\n  return s;\n};\n\nUtils.mineFlagByIndex = function(creep) {\n  return MineFlags[creep.index() % MineFlags.length - 1];\n};\n\nUtils.guardFlagByIndex = function(creep) {\n  return GuardFlags[creep.index() % GuardFlags.length - 1];\n};\n\nUtils.Repair = function(creep, source) {\n  return new Deliverator(creep, source, new PathUtils(creep).sortByDistance(primaryRoom.my_structures.filter(function(s) {\n    return s.structureType !== 'rampart' && s.hits < Math.min(s.hitsMax, Config.MaxWallHP);\n  }))[0]).loop();\n};\n\nUtils.BuildThings = function(creep) {\n  return new Builder(creep, null, Game.flags.BuildHere).loop();\n};\n\nUtils.HealFlag = function(creep, rally, leash_distance) {\n  var nearestTarget, pathUtils, room;\n  if (leash_distance == null) {\n    leash_distance = 5;\n  }\n  rally || (rally = Game.flags.HuntersMark2);\n  if (!creep.pos.inRangeTo(rally, leash_distance + 3)) {\n    return creep.moveTo(rally.pos, {\n      ignoreDestructibleStructures: true,\n      maxOps: 1000\n    });\n  }\n  room = creep.room;\n  if (room.friendly_creeps == null) {\n    room.friendly_creeps = room.find(FIND_MY_CREEPS);\n  }\n  pathUtils = new PathUtils(creep);\n  nearestTarget = pathUtils.sortByDistance(room.friendly_creeps.filter(function(c) {\n    return c.hits < c.hitsMax;\n  }))[0];\n  if ((nearestTarget != null) && rally.pos.getRangeTo(nearestTarget) > leash_distance) {\n    nearestTarget = null;\n  }\n  if (nearestTarget != null) {\n    if (creep.rangedHeal(nearestTarget) === ERR_NOT_IN_RANGE) {\n      return creep.moveTo(nearestTarget);\n    }\n  } else {\n    return creep.moveTo(rally.pos);\n  }\n};\n\nUtils.GuardFlag = function(creep, rally, leash_distance) {\n  var attacked, err, nearestTarget, pathUtils, room;\n  if (leash_distance == null) {\n    leash_distance = 5;\n  }\n  rally || (rally = Game.flags.HuntersMark2);\n  if (!creep.pos.inRangeTo(rally, leash_distance)) {\n    creep.log(\"Too far\");\n    return creep.moveTo(rally.pos);\n  }\n  room = creep.room;\n  if (room.hostile_creeps == null) {\n    room.hostile_creeps = room.find(FIND_HOSTILE_CREEPS);\n  }\n  nearestTarget = null;\n  pathUtils = new PathUtils(creep);\n  nearestTarget || (nearestTarget = pathUtils.sortByDistance(room.hostile_creeps)[0]);\n  if ((nearestTarget != null) && rally.pos.getRangeTo(nearestTarget) > leash_distance) {\n    nearestTarget = null;\n  }\n  if (nearestTarget != null) {\n    console.log(\"Nearing in on \" + nearestTarget.id + \" at \" + (creep.pos.getRangeTo(nearestTarget)));\n    attacked = true;\n    if (creep.body.filter(function(p) {\n      return p.type === ATTACK && p.hits > 0;\n    }).length > 0 && isEnemy(nearestTarget.owner.username)) {\n      if ((err = creep.attack(nearestTarget)) === ERR_NOT_IN_RANGE) {\n        creep.moveTo(nearestTarget);\n      }\n    }\n    if (creep.body.filter(function(p) {\n      return p.type === RANGED_ATTACK && p.hits > 0;\n    }).length > 0 && isEnemy(nearestTarget.owner.username)) {\n      if ((err = creep.rangedAttack(nearestTarget)) === ERR_NOT_IN_RANGE) {\n        return creep.moveTo(nearestTarget);\n      }\n    }\n  } else {\n    return creep.moveTo(rally.pos);\n  }\n};\n\nUtils.minerByIndex = function(index) {\n  index = index % TaskCounts[\"miner\"];\n  return Game.getObjectById(Creeps[\"miner_\" + index]);\n};\n\nGuardFlags = [Game.flags.HuntersMark2];\n\nMineFlags = [Game.flags.Mine_1_1, Game.flags.Mine_1_2, Game.flags.Mine_3_1, Game.flags.Mine_3_2, Game.flags.Mine_4_1];\n\nUtils.FlagMiner = function(creep) {\n  var err, index, source, targetFlag;\n  if (creep.carry.energy === creep.carryCapacity) {\n    return;\n  }\n  index = creep.index();\n  targetFlag = MineFlags[index % MineFlags.length];\n  if (targetFlag.pos.roomName !== creep.pos.roomName) {\n    err = creep.moveTo(targetFlag.pos, {\n      reusePath: 40,\n      ignoreCreeps: false,\n      maxOps: 1000\n    });\n    if (err !== 0) {\n      console.log(\"flag miner error = \" + err);\n    }\n    return;\n  }\n  if (!creep.memory.sourceId) {\n    creep.memory.sourceId = new PathUtils(targetFlag.pos).sortByDistance(targetFlag.room.find(FIND_SOURCES))[0].id;\n  }\n  if (creep.memory.sourceId) {\n    source = Game.getObjectById(creep.memory.sourceId);\n  }\n  if (!creep.pos.isNearTo(source.pos)) {\n    creep.moveTo(source, {\n      reusePath: 10\n    });\n  }\n  if (creep.harvest(source) === -7) {\n    return delete creep.memory.sourceId;\n  }\n};\n\nUtils.MineTransporter = function(creep, dumpLocation) {\n  var source;\n  source = Utils.minerByIndex(creep.index());\n  if (source != null) {\n    return new Deliverator(creep, source, dumpLocation).loop();\n  }\n};\n\nserializeArg = function(arg) {\n  if (arg.id != null) {\n    return {\n      'id': arg.id\n    };\n  }\n  if (typeof Utils[arg[\"function\"]] === 'function') {\n    return {\n      'function': arg\n    };\n  }\n  return arg;\n};\n\nresolveArgs = function(creep) {\n  return function(arg) {\n    if (arg.id != null) {\n      return Game.getObjectById(arg.id);\n    }\n    if ((arg[\"function\"] != null) && typeof Utils[arg[\"function\"]] === 'function') {\n      return Utils[arg[\"function\"]](creep);\n    }\n    if ((arg != null) && typeof Utils[arg] === 'function') {\n      return Utils[arg](creep);\n    }\n    if (arg[\"function\"] != null) {\n      return arg[\"function\"];\n    }\n    return arg;\n  };\n};\n\nRole = (function() {\n  function Role() {}\n\n  Role.prototype.run = function(realStartCpu) {\n    var _, creepEnergy, endCpu, ref1, roomCpu, spawn, startCpu, storage, towerEnergy;\n    startCpu = Game.cpu.getUsed();\n    ref1 = Game.spawns;\n    for (_ in ref1) {\n      spawn = ref1[_];\n      storage = spawn.room.find(FIND_MY_STRUCTURES).filter(function(s) {\n        return s.structureType === STRUCTURE_STORAGE;\n      })[0];\n      towerEnergy = this.runTowers(spawn.room);\n      this.runSpawner(spawn);\n      creepEnergy = ((function() {\n        var k, len1, ref2, results;\n        ref2 = spawn.room.find(FIND_MY_CREEPS);\n        results = [];\n        for (k = 0, len1 = ref2.length; k < len1; k++) {\n          creep = ref2[k];\n          results.push(creep.carry.energy);\n        }\n        return results;\n      })()).sum();\n      console.log(\" Spawn: \" + (this.spawnEnergy(spawn.room)) + \"/\" + (this.spawnEnergyCapacity(spawn.room)) + \"\\tTower: \" + towerEnergy + \"\\tCreep: \" + creepEnergy + \"\\tStore: \" + storage.store.energy + \"\\t\");\n    }\n    roomCpu = Game.cpu.getUsed();\n    this.runCreeps();\n    endCpu = Game.cpu.getUsed();\n    return console.log(\"Time total: \" + (endCpu - realStartCpu) + \"\\t\\t Load: \" + (startCpu - realStartCpu) + \"\\t\\tCode: \" + (endCpu - startCpu) + \"\\t\\tBase: \" + (roomCpu - startCpu) + \"\\t\\t Creep: \" + (endCpu - roomCpu) + \"\\t\\tCPU Bucket: \" + Game.cpu.bucket);\n  };\n\n  Role.prototype.runSpawner = function(spawn) {\n    var creepId, curCreepCount, idx, k, l, len1, name2, ref1, ref2, roleName, start;\n    if (spawn.spawning) {\n      console.log(\"Spawning \" + (JSON.stringify(spawn.spawning)));\n    }\n    curCreepCount = {};\n    for (k = 0, len1 = Tasks.length; k < len1; k++) {\n      t = Tasks[k];\n      start = curCreepCount[t.role] || 0;\n      for (idx = l = ref1 = start, ref2 = start + t.count - 1; ref1 <= ref2 ? l <= ref2 : l >= ref2; idx = ref1 <= ref2 ? ++l : --l) {\n        roleName = t.role + \"_\" + idx;\n        creepId = Creeps[roleName];\n        if (creepId == null) {\n          if (!spawn.spawning) {\n            if (this.spawnCreepFromTask(spawn, roleName, t)) {\n              return;\n            }\n          }\n        } else {\n          creep = Game.getObjectById(creepId);\n          if (creep.memory.action != null) {\n            continue;\n          }\n          creep.memory = Memory[name2 = creep.name] || (Memory[name2] = {});\n          creep.memory.action = t.action;\n          creep.memory.roleName = roleName;\n          creep.memory.args = t.args;\n        }\n      }\n      curCreepCount[t.role] = start + idx;\n    }\n  };\n\n  Role.prototype.runTowers = function(room) {\n    var attacked, energy, k, len1, nearestTarget, pathUtils, ref1, tower;\n    energy = 0;\n    ref1 = tower = room.my_structures.filter(function(s) {\n      return s.structureType === 'tower';\n    });\n    for (k = 0, len1 = ref1.length; k < len1; k++) {\n      tower = ref1[k];\n      pathUtils = new PathUtils(tower);\n      nearestTarget = pathUtils.sortByDistance(room.hostile_creeps.filter(function(c) {\n        return c.body.indexOf(HEAL) > -1;\n      }))[0];\n      nearestTarget || (nearestTarget = pathUtils.sortByDistance(room.hostile_creeps.filter(function(c) {\n        return c.body.indexOf(RANGED_ATTACK) > -1;\n      }))[0]);\n      nearestTarget || (nearestTarget = pathUtils.sortByDistance(room.hostile_creeps)[0]);\n      if (nearestTarget != null) {\n        attacked = true;\n        tower.attack(nearestTarget);\n      }\n      if (!attacked && tower.energy > tower.energyCapacity / 2) {\n        nearestTarget = pathUtils.sortByDistance(room.my_creeps.filter(function(c) {\n          return c.hits < c.hitsMax;\n        }));\n        if (nearestTarget != null) {\n          tower.heal(nearestTarget);\n        }\n        nearestTarget = pathUtils.sortByDistance(room.my_structures.filter(function(s) {\n          return s.hits < Math.min(s.hitsMax, Config.MaxWallHP);\n        }))[0];\n        if (nearestTarget == null) {\n          nearestTarget = pathUtils.sortByDistance(room.find(FIND_STRUCTURES).filter(function(s) {\n            return s.structureType === STRUCTURE_ROAD && s.hits < Math.min(s.hitsMax, Config.MaxWallHP);\n          }))[0];\n        }\n        if (nearestTarget != null) {\n          tower.repair(nearestTarget);\n        }\n      }\n      energy += tower.energy;\n    }\n    return energy;\n  };\n\n  Role.prototype.runCreeps = function() {\n    var _, creepId, e, results;\n    results = [];\n    for (_ in Creeps) {\n      creepId = Creeps[_];\n      creep = Game.getObjectById(creepId);\n      try {\n        results.push(this.runCreep(creep));\n      } catch (_error) {\n        e = _error;\n        creep.log(creep);\n        creep.log(e.stack);\n        results.push(creep.log(\"Error running creeps \" + creep.role + \"_\" + creep.index));\n      }\n    }\n    return results;\n  };\n\n  Role.prototype.spawnCreepFromTask = function(spawnFrom, roleName, task) {\n    var memory, parts, partsCost, ret, room;\n    room = spawnFrom.room;\n    name = this.nameForRole(roleName);\n    parts = this.makeRole(task.body);\n    memory = {\n      'action': task.action,\n      args: task.args.map(serializeArg),\n      roleName: roleName\n    };\n    partsCost = this.partsCost(parts);\n    if (partsCost > this.spawnEnergyCapacity(room)) {\n      console.log(\"Can't spawn \" + roleName + \" due to max capacity -- have \" + (this.spawnEnergyCapacity(room)) + \"/\" + partsCost);\n      Game.notify(\"Can't spawn \" + roleName + \" due to max capacity -- have \" + (this.spawnEnergyCapacity(room)) + \"/\" + partsCost, 60);\n      return false;\n      console.log(\"Would spawn creep \" + name + \" with \" + memory + \" and \" + parts);\n    }\n    ret = 0;\n    ret = spawnFrom.createCreep(parts, name, memory);\n    if (ret === ERR_NOT_ENOUGH_RESOURCES) {\n      console.log(\"Can't spawn \" + roleName + \" due to resources -- have \" + (this.spawnEnergy(room)) + \"/\" + partsCost);\n      return true;\n    } else if (ret < 0) {\n      console.log(\"Can't spawn \" + roleName + \" due to other error: \" + ret + \" -- have \" + (this.spawnEnergy(room)) + \"/\" + partsCost);\n      if (ret === -3) {\n        room.memory.totalCreepCounts[roleName]++;\n      }\n      return false;\n    } else {\n      if (ret === 0) {\n        room.memory.totalCreepCounts[roleName]++;\n      }\n      console.log(\"Spawning \" + roleName + \" named \" + name + \" from \" + spawnFrom.name + \" with \" + parts + \" and \" + (JSON.stringify(memory)) + \", got \" + ret);\n    }\n    return true;\n  };\n\n  Role.prototype.runCreep = function(creep) {\n    var action;\n    action = creep.memory.action;\n    if ((action != null) && (Utils[action] != null)) {\n      return Utils[action].apply(Utils, [creep].concat(slice.call(creep.memory.args.map(resolveArgs(creep)))));\n    } else {\n      return creep.log(\"Failed to run action for \" + creep.name + \" - action = \" + creep.action + \", memory = \" + (JSON.stringify(creep.memory)));\n    }\n  };\n\n  Role.prototype.partsCost = function(parts) {\n    return parts.map(function(s) {\n      switch (s) {\n        case TOUGH:\n          return 10;\n        case MOVE:\n        case CARRY:\n          return 50;\n        case ATTACK:\n          return 80;\n        case WORK:\n          return 100;\n        case RANGED_ATTACK:\n          return 150;\n        case HEAL:\n          return 250;\n      }\n    }).sum();\n  };\n\n  Role.prototype.makeRole = function(partsMap) {\n    var count, i, k, part, parts, ref1;\n    parts = [];\n    for (part in partsMap) {\n      count = partsMap[part];\n      for (i = k = 0, ref1 = count; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {\n        parts.push(part);\n      }\n    }\n    return parts;\n  };\n\n  Role.prototype.nameForRole = function(roleName) {\n    var base;\n    Memory.totalCreepCounts || (Memory.totalCreepCounts = {});\n    (base = Memory.totalCreepCounts)[roleName] || (base[roleName] = 0);\n    return roleName + \"_\" + Memory.totalCreepCounts[roleName];\n  };\n\n  Role.prototype.spawnEnergyCapacity = function(room) {\n    var s;\n    return ((function() {\n      var k, len1, ref1, results;\n      ref1 = room.find(FIND_MY_STRUCTURES);\n      results = [];\n      for (k = 0, len1 = ref1.length; k < len1; k++) {\n        s = ref1[k];\n        if (s.structureType === 'extension' || s.structureType === \"spawn\") {\n          results.push(s.energyCapacity);\n        }\n      }\n      return results;\n    })()).sum();\n  };\n\n  Role.prototype.spawnEnergy = function(room) {\n    var s;\n    return ((function() {\n      var k, len1, ref1, results;\n      ref1 = room.find(FIND_MY_STRUCTURES);\n      results = [];\n      for (k = 0, len1 = ref1.length; k < len1; k++) {\n        s = ref1[k];\n        if (s.structureType === 'extension' || s.structureType === \"spawn\") {\n          results.push(s.energy);\n        }\n      }\n      return results;\n    })()).sum();\n  };\n\n  return Role;\n\n})();\n\nBuilder = (function(superClass) {\n  extend(Builder, superClass);\n\n  function Builder(creep1, sourceFn, rallyFlag) {\n    var source;\n    this.creep = creep1;\n    if (sourceFn == null) {\n      sourceFn = null;\n    }\n    if (rallyFlag == null) {\n      rallyFlag = null;\n    }\n    this.constructionSite = bind(this.constructionSite, this);\n    if (rallyFlag != null) {\n      this.target = rallyFlag;\n    } else {\n      this.target = creep;\n    }\n    if (sourceFn == null) {\n      this.pathUtils || (this.pathUtils = new PathUtils(this.target));\n      source = this.pathUtils.sortByDistance(Utils.energyProviders(creep))[0];\n      console.log(source);\n    }\n    Builder.__super__.constructor.call(this, creep, source, this.constructionSite());\n    creep.memory.energyRequester = true;\n  }\n\n  Builder.prototype.ramparts = function(s) {\n    return (s.structureType === 'rampart') && (s.hits < Math.min(Config.MaxWallHP, s.hitsMax));\n  };\n\n  Builder.prototype.walls = function(s) {\n    return s.structureType === 'constructedWall' && s.hits < Math.min(s.hitsMax, Config.MaxWallHP || 3000000);\n  };\n\n  Builder.prototype.constructionSite = function() {\n    var ref1, ref2, ref3, ref4, sites;\n    this.pathUtils || (this.pathUtils = new PathUtils(this.target));\n    sites = this.pathUtils.sortByDistance(this.creep.room.find(FIND_MY_CONSTRUCTION_SITES));\n    if (sites.length === 0) {\n      sites = [];\n      sites = sites.concat((ref1 = Game.flags.Room2) != null ? (ref2 = ref1.room) != null ? ref2.find(FIND_MY_CONSTRUCTION_SITES) : void 0 : void 0);\n      sites = sites.concat((ref3 = Game.flags.Room3) != null ? (ref4 = ref3.room) != null ? ref4.find(FIND_MY_CONSTRUCTION_SITES) : void 0 : void 0);\n      sites = this.pathUtils.sortByDistance(sites);\n    }\n    if (sites.length === 0) {\n      sites = this.pathUtils.sortByDistance(this.creep.room.find(FIND_MY_STRUCTURES).filter(this.ramparts));\n    }\n    if (sites.length === 0) {\n      sites = this.pathUtils.sortByDistance(this.creep.room.find(FIND_STRUCTURES).filter(this.walls));\n    }\n    return sites[0];\n  };\n\n  return Builder;\n\n})(Deliverator);\n\nmodule.exports = Role;\n\n//# sourceMappingURL=roles.js.map\n","var Tasks, primaryRoom, primarySpawn, primaryStorage, ref;\n\nprimarySpawn = Game.spawns.Spawn1;\n\nprimaryRoom = primarySpawn.room;\n\nprimaryRoom.my_structures = primaryRoom.find(FIND_MY_STRUCTURES);\n\nprimaryRoom.my_creeps = primaryRoom.find(FIND_MY_CREEPS);\n\nprimaryRoom.hostile_creeps = primaryRoom.find(FIND_HOSTILE_CREEPS);\n\nprimaryStorage = primaryRoom.my_structures.filter(function(s) {\n  return s.structureType === STRUCTURE_STORAGE;\n})[0];\n\nTasks = [\n  {\n    role: \"small_transporter\",\n    body: {\n      carry: 2,\n      move: 1\n    },\n    action: 'CarryStuff',\n    args: [primaryStorage, 'nearestPrimarySpawnOrExtension'],\n    count: 1\n  }, {\n    role: \"upgarder\",\n    body: {\n      work: 8,\n      carry: 2,\n      move: 5\n    },\n    action: 'CarryStuff',\n    args: [primaryStorage, Game.spawns.Spawn1.room.controller],\n    count: 2\n  }, {\n    role: \"builder\",\n    body: {\n      work: 8,\n      carry: 2,\n      move: 5\n    },\n    action: 'BuildThings',\n    args: [],\n    count: 2\n  }, {\n    role: \"dump_truck\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'MineTransporter',\n    args: [primaryStorage],\n    count: 2\n  }, {\n    role: \"tower_filler\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'CarryStuff',\n    args: [primaryStorage, 'nearestTowerSpawnExtension'],\n    count: 1\n  }, {\n    role: \"big_transporter\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'CarryStuff',\n    args: [primaryStorage, 'nearestPrimarySpawnOrExtension'],\n    count: 1\n  }, {\n    role: \"controller_healer\",\n    body: {\n      tough: 14,\n      move: 7,\n      heal: 4\n    },\n    action: 'HealFlag',\n    args: ['guardFlagByIndex', 7],\n    count: 2\n  }, {\n    role: \"mine_ranger\",\n    body: {\n      tough: 15,\n      move: 11,\n      ranged_attack: 7\n    },\n    action: 'GuardFlag',\n    args: [Game.flags.Flag1, 7],\n    count: 2\n  }, {\n    role: \"mine_guard\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: [Game.flags.Flag1, 7],\n    count: 5\n  }, {\n    role: \"mine_ranger\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: [Game.flags.Flag1, 7],\n    count: 2\n  }, {\n    role: \"miner\",\n    body: {\n      work: 5,\n      carry: 6,\n      move: 6\n    },\n    action: 'FlagMiner',\n    args: [],\n    count: 2\n  }, {\n    role: \"fodder\",\n    body: {\n      tough: 10,\n      move: 7,\n      attack: 5\n    },\n    action: 'GuardFlag',\n    args: [Game.flags.Flag1, 7],\n    count: 5\n  }, {\n    role: \"mine_guard\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: [Game.flags.Flag1, 7],\n    count: 5\n  }, {\n    role: \"miner\",\n    body: {\n      work: 5,\n      carry: 6,\n      move: 6\n    },\n    action: 'FlagMiner',\n    args: [],\n    count: 2\n  }, {\n    role: \"dump_truck\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'MineTransporter',\n    args: [primaryStorage],\n    count: 2\n  }, {\n    role: \"repair\",\n    body: {\n      work: 6,\n      carry: 4,\n      move: 5\n    },\n    action: 'Repair',\n    args: [primaryStorage],\n    count: 1\n  }, {\n    role: \"controller_guard\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: ['guardFlagByIndex', 7],\n    count: 2\n  }, {\n    role: \"upgarder_room2\",\n    body: {\n      work: 8,\n      carry: 2,\n      move: 5\n    },\n    action: 'CarryStuff',\n    args: [primaryStorage, (ref = Game.flags.Room3.room) != null ? ref.controller : void 0],\n    count: 1\n  }, {\n    role: \"controller_healer\",\n    body: {\n      tough: 20,\n      move: 12,\n      heal: 4\n    },\n    action: 'GuardFlag',\n    args: ['guardFlagByIndex', 7],\n    count: 1\n  }, {\n    role: \"miner\",\n    body: {\n      work: 5,\n      carry: 6,\n      move: 6\n    },\n    action: 'FlagMiner',\n    args: [],\n    count: 2\n  }, {\n    role: \"dump_truck\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'MineTransporter',\n    args: [primaryStorage],\n    count: 2\n  }, {\n    role: \"mine_guard\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: ['mineFlagByIndex', 7],\n    count: 2\n  }, {\n    role: \"dump_truck\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'MineTransporter',\n    args: [primaryStorage],\n    count: 2\n  }, {\n    role: \"mine_guard\",\n    body: {\n      tough: 20,\n      move: 15,\n      attack: 10\n    },\n    action: 'GuardFlag',\n    args: ['mineFlagByIndex', 7],\n    count: 1\n  }, {\n    role: \"miner\",\n    body: {\n      work: 5,\n      carry: 6,\n      move: 6\n    },\n    action: 'FlagMiner',\n    args: [],\n    count: 1\n  }, {\n    role: \"dump_truck\",\n    body: {\n      carry: 6,\n      move: 3\n    },\n    action: 'MineTransporter',\n    args: [primaryStorage],\n    count: 8\n  }\n];\n\nmodule.exports = Tasks;\n\n//# sourceMappingURL=tasks.js.map\n"]}